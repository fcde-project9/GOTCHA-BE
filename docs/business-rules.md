# 비즈니스 규칙

## 사용자 (User)

### 닉네임 생성 규칙

**형식**: `{형용사}{명사}#{숫자}`

**형용사 풀 (예시)**
```
빨간, 파란, 노란, 초록, 보라, 하얀, 검은, 금빛, 은빛, 무지개
반짝이는, 귀여운, 멋진, 신비한, 용감한, 행복한, 졸린, 배고픈
```

**명사 풀 (예시)**
```
캡슐, 뽑기, 가챠, 피규어, 인형, 토끼, 고양이, 강아지, 곰돌이
용사, 마법사, 공주, 왕자, 요정, 드래곤
```

**숫자**: 1-99 랜덤

**예시**: `빨간캡슐#21`, `반짝이는토끼#7`, `용감한드래곤#55`

### 닉네임 제약 조건

| 항목 | 규칙 |
|------|------|
| 길이 | 2-20자 |
| 허용 문자 | 한글, 영문, 숫자, #, _ |
| 금지어 | 욕설, 비속어 필터링 |
| 중복 | 불가 (unique) |

### 게스트 사용자

| 기능 | 허용 |
|------|------|
| 가게 목록/상세 조회 | ✅ |
| 검색 | ✅ |
| 찜 추가/삭제 | ❌ (로그인 필요) |
| 댓글/리뷰 작성 | ❌ (로그인 필요) |
| 제보 | ❌ (로그인 필요) |
| 마이페이지 | ❌ (로그인 필요) |

---

## 가게 (Shop)

### 영업중 판단 로직

```java
// openTime JSON 형식
{
  "mon": "10:00-22:00",
  "tue": "10:00-22:00",
  "wed": null,           // 휴무
  "thu": "10:00-22:00",
  "fri": "10:00-23:00",
  "sat": "10:00-23:00",
  "sun": "12:00-20:00"
}

// 판단 로직
1. 현재 요일의 영업시간 조회
2. null이면 휴무 → isOpen = false
3. 현재 시간이 영업시간 범위 내인지 확인
4. 범위 내면 isOpen = true
```

### 거리 계산

**Haversine 공식** 사용

```java
// 두 좌표 간 거리 (미터)
distance = haversine(lat1, lng1, lat2, lng2)

// 결과 표시
- 1000m 미만: "300m"
- 1000m 이상: "1.2km"
```

### 제보 규칙

| 항목 | 규칙 |
|------|------|
| 중복 체크 | 반경 50m 내 동일 가게명 있으면 중복으로 판단 |
| 승인 방식 | 즉시 등록 (MVP) |
| 익명 제보 | 가능 (isAnonymous = true) |
| 수정/삭제 | 제보자 본인만 가능 (추후) |

### 검색/정렬

**검색 범위**
- 기본 반경: 1000m
- 최대 반경: 5000m

**정렬 옵션**
| 옵션 | 설명 |
|------|------|
| distance (기본) | 현재 위치에서 가까운 순 |
| newest | 등록일 최신순 |

---

## 찜 (Favorite)

| 항목 | 규칙 |
|------|------|
| 최대 개수 | 제한 없음 |
| 중복 찜 | 불가 (user_id + shop_id unique) |
| 삭제된 가게 | 찜 목록에서 자동 제외 |

---

## 댓글 (Comment)

| 항목 | 규칙 |
|------|------|
| 글자 수 | 1-500자 |
| 익명 | 가능 |
| 수정 | 작성자 본인만, 작성 후 24시간 내 |
| 삭제 | 작성자 본인만 |
| 신고 | 추후 구현 |

### 익명 댓글 표시

```json
// 익명인 경우
{
  "author": {
    "id": null,
    "nickname": "익명",
    "profileImageUrl": null
  },
  "isAnonymous": true
}
```

---

## 리뷰 (Review)

| 항목 | 규칙 |
|------|------|
| 글자 수 | 10-1000자 |
| 이미지 | 선택, 1장 |
| 익명 | 불가 (후기/인증 목적) |
| 수정 | 작성자 본인만 |
| 삭제 | 작성자 본인만 |
| 중복 작성 | 같은 가게에 여러 리뷰 가능 |

---

## 신고 (추후 구현)

### 신고 사유

```
- 허위 정보
- 중복 등록
- 폐업/이전
- 부적절한 내용
- 기타
```

### 처리 프로세스

```
1. 사용자 신고
2. 관리자 검토
3. 승인 시: 숨김/삭제 처리
4. 반려 시: 유지
```

---

## 알림 (추후 구현)

### 알림 대상 이벤트

| 이벤트 | 수신자 |
|--------|--------|
| 내 제보 가게에 댓글 | 제보자 |
| 내 제보 가게에 리뷰 | 제보자 |
| 내 댓글에 답글 | 댓글 작성자 |
| 찜한 가게 정보 변경 | 찜한 사용자들 |

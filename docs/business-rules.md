# 비즈니스 규칙

## 사용자 (User)

### 닉네임 생성 규칙

**형식**: `{형용사}{명사}#{숫자}`

**형용사 풀 (예시)**
```
빨간, 파란, 노란, 초록, 보라, 하얀, 검은, 금빛, 은빛, 무지개
반짝이는, 귀여운, 멋진, 신비한, 용감한, 행복한, 졸린, 배고픈
```

**명사 풀 (예시)**
```
캡슐, 뽑기, 가챠, 피규어, 인형, 토끼, 고양이, 강아지, 곰돌이
용사, 마법사, 공주, 왕자, 요정, 드래곤
```

**숫자**: 0-9999 랜덤

**예시**: `빨간캡슐#21`, `반짝이는토끼#7`, `용감한드래곤#5501`

### 닉네임 제약 조건

| 항목 | 규칙 |
|------|------|
| 길이 | 2-20자 |
| 허용 문자 | 한글, 영문, 숫자, #, _ |
| 금지어 | 욕설, 비속어 필터링 |
| 중복 | 불가 (unique) |

### 게스트 사용자

| 기능 | 허용 |
|------|------|
| 가게 목록/상세 조회 | O |
| 검색 | O |
| 찜 추가/삭제 | X (로그인 필요) |
| 댓글/리뷰 작성 | X (로그인 필요) |
| 제보 | X (로그인 필요) |
| 마이페이지 | X (로그인 필요) |

### 회원 탈퇴

| 항목 | 규칙 |
|------|------|
| 탈퇴 설문 | 필수 (reasons 최소 1개 선택) |
| 사용자 처리 | Soft Delete (is_deleted = true, 개인정보 마스킹) |
| 닉네임 처리 | "탈퇴한 사용자_{id}"로 변경 |
| 소셜 연동 | 해제 (socialId, socialType = null) |
| 재가입 | 가능 (동일 소셜 계정으로 새 계정 생성) |

**탈퇴 시 삭제되는 데이터**
| 데이터 | 삭제 방식 |
|--------|----------|
| 찜 목록 | 물리 삭제 |
| 리뷰 | 물리 삭제 |
| 리뷰 이미지 | GCS + DB 물리 삭제 |
| 댓글 | 물리 삭제 |
| Refresh Token | 물리 삭제 |

**탈퇴 사유 (복수 선택 가능)**
```
- LOW_USAGE: 사용을 잘 안하게 돼요
- INSUFFICIENT_INFO: 가챠샵 정보가 부족해요
- INACCURATE_INFO: 가챠샵 정보가 기재된 내용과 달라요
- PRIVACY_CONCERN: 개인정보 보호를 위해 삭제할래요
- HAS_OTHER_ACCOUNT: 다른 계정이 있어요
- OTHER: 기타 (상세 사유 입력)
```

---

## 가게 (Shop)

### 영업 상태 판단 로직

```java
// openTime 형식: JSON 문자열 (예: {"Mon":"10:00-22:00","Tue":"","Wed":"10:00-22:00"})
// - 각 요일(Mon, Tue, Wed, Thu, Fri, Sat, Sun)별 영업시간 지정
// - 영업시간 형식: "HH:mm-HH:mm" (예: "10:00-22:00")
// - 휴무일은 빈 문자열("")로 지정
// - null은 영업시간 정보가 없음을 의미

// 판단 로직 (한국 시간 기준)
1. openTime이 null 또는 비어있으면 → openStatus = "" (정보 없음)
2. 오늘 요일의 영업시간이 빈 문자열("")이면 → openStatus = "휴무"
3. 오늘 요일의 영업시간이 null이면 → openStatus = "" (정보 없음)
4. 오늘 요일의 영업시간 형식이 잘못되면 → openStatus = ""
5. 현재 시간이 영업시간 범위 내인지 확인:
   - 범위 내면 → openStatus = "영업 중"
   - 범위 밖이면 → openStatus = "영업 종료"
6. 자정을 넘어가는 영업시간도 지원 (예: "22:00-02:00")

// openStatus 값
- "영업 중": 현재 영업 중
- "영업 종료": 오늘 영업 종료됨
- "휴무": 오늘 휴무일 (빈 문자열)
- "": 영업시간 정보 없음 (null)
```

### 거리 계산

**Haversine 공식** 사용

```java
// 두 좌표 간 거리 (미터)
distance = haversine(lat1, lng1, lat2, lng2)

// 결과 표시
- 1000m 미만: "300m"
- 1000m 이상: "1.2km"
```

### 제보 규칙

| 항목 | 규칙 |
|------|------|
| 필수 입력 | 업체명, 위도/경도, 업체 사진 |
| 선택 입력 | 영업시간, 위치 힌트 |
| 주소 | 좌표로부터 카카오 API로 자동 변환 |
| 중복 체크 | 반경 50m 내 동일 가게명 있으면 중복으로 판단 |
| 승인 방식 | 즉시 등록 (MVP) |
| 수정/삭제 | 제보자 본인만 가능 (추후) |

### 검색/정렬

**검색 범위**
- 기본 반경: 1000m
- 최대 반경: 5000m

**정렬 옵션**
| 옵션 | 설명 |
|------|------|
| distance (기본) | 현재 위치에서 가까운 순 |
| newest | 등록일 최신순 |

**이름 검색**
- 최소 2자 이상 입력
- 부분 일치 (LIKE '%keyword%')

---

## 찜 (Favorite)

| 항목 | 규칙 |
|------|------|
| 최대 개수 | 제한 없음 |
| 중복 찜 | 불가 (user_id + shop_id unique) |
| 삭제된 가게 | 찜 목록에서 자동 제외 |

---

## 댓글 (Comment)

| 항목 | 규칙 |
|------|------|
| 글자 수 | 1-500자 |
| 익명 | 가능 |
| 수정 | 작성자 본인만, 작성 후 24시간 내 |
| 삭제 | 작성자 본인만 |
| 신고 | 추후 구현 |

### 익명 댓글 표시

```json
// 익명인 경우
{
  "author": {
    "id": null,
    "nickname": "익명",
    "profileImageUrl": null
  },
  "isAnonymous": true
}
```

---

## 리뷰 (Review)

| 항목 | 규칙 |
|------|------|
| 글자 수 | 10-1000자 |
| 이미지 | 선택, 최대 10장 |
| 익명 | 불가 (후기/인증 목적) |
| 수정 | 작성자 본인만 |
| 삭제 | 작성자 본인만 |
| 중복 작성 | 같은 가게에 여러 리뷰 가능 |

---

## 이미지 (Image)

| 항목 | 규칙 |
|------|------|
| 허용 확장자 | jpg, jpeg, png, webp |
| 최대 크기 | 10MB |
| 용도 구분 | shop (가게 사진), review (리뷰 사진) |

---

## 신고 (추후 구현)

### 신고 사유

```
- 허위 정보
- 중복 등록
- 폐업/이전
- 부적절한 내용
- 기타
```

### 처리 프로세스

```
1. 사용자 신고
2. 관리자 검토
3. 승인 시: 숨김/삭제 처리
4. 반려 시: 유지
```

---

## 알림 (추후 구현)

### 알림 대상 이벤트

| 이벤트 | 수신자 |
|--------|--------|
| 내 제보 가게에 댓글 | 제보자 |
| 내 제보 가게에 리뷰 | 제보자 |
| 내 댓글에 답글 | 댓글 작성자 |
| 찜한 가게 정보 변경 | 찜한 사용자들 |
